<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="fav.png" type="image/x-icon">
    <title>MiniFlix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        * {
            font-family: Arial, Helvetica, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .nav-bar {
            border-bottom: 3px solid #e6e6e6;
            height: 70px;
            max-width: 100%;
            display: flex;
            align-items: center;
        }

        .Logo {
            margin-bottom: 30px;
        }

        .box {
            text-align: center;
            position: absolute;
            top: 50%;
            left: 50%;
            border: 3px solid black;
            padding: 50px;
            width: 600px;
            transform: translate(-50%, -50%);
            border-radius: 10px;
        }

        .logo {
            margin-left: 30px;
            float: left;
        }

        .Sign-out-btn {
            color: white;
            background-color: #e50914;
            border-radius: 10px;
            padding: 5px 15px;
            font-size: large;
            margin-top: 25px;
            margin-bottom: 25px;
            float: right;
            margin-left: auto;
            border: none;
            border: 1px solid #e50914;
            margin-right: 50px;
        }

        .header {
            text-align: center;
            font-weight: 500;
        }

        .header h4 {
            padding: 10px;
        }

        .inputs {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .input {
            width: 40px;
            height: 50px;
            margin: 0 5px;
            text-align: center;
            font-size: 36px;
        }

        .Done {
            color: white;
            background-color: #e50914;
            border-radius: 10px;
            padding: 5px 15px;
            font-size: large;
            margin-top: 25px;
            border: none;
            border: 1px solid #e50914;
            margin-right: 0;
        }
    </style>
</head>

<body>
    <div class="nav-bar">
        <div class="logo">
            <img src="/MINIFLIX-LOGO.png" alt="LOGO" width="40%">
        </div>
        <input type="button" value="Sign Out" class="Sign-out-btn" id="log-out-btn">
    </div>
    <div class="box">
        <div class="header">
            <div class="Logo">
                <img src="/verification-logo_-removebg-preview.png" alt="">
            </div>
            <h1><b>Great, now let's verify your email id</b></h1>
            <h4>
                <p id="otp-msg"></p>
            </h4>
            <div id="inputs" class="inputs">
                <input class="input" type="text" inputmode="numeric" maxlength="1" />
                <input class="input" type="text" inputmode="numeric" maxlength="1" />
                <input class="input" type="text" inputmode="numeric" maxlength="1" />
                <input class="input" type="text" inputmode="numeric" maxlength="1" />
            </div>
        </div>
        <input type="button" value="Submit" class="Done" id="done-btn">
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const inputs = document.getElementById("inputs");
            const doneBtn = document.getElementById("done-btn");
            const email = localStorage.getItem('userEmail');
            const otpMsg = document.getElementById('otp-msg');

            if (email) {
                otpMsg.textContent = `We sent you a code to your ${email} to verify.`;
            }

            inputs.addEventListener("input", function (e) {
                const target = e.target;
                const val = target.value;

                if (isNaN(val) || val.length > 1) {
                    target.value = "";
                    return;
                }

                if (val !== "") {
                    const next = target.nextElementSibling;
                    if (next) {
                        next.focus();
                    }
                }
            });

            inputs.addEventListener("keyup", function (e) {
                const target = e.target;
                const key = e.key.toLowerCase();

                if (key === "backspace" || key === "delete") {
                    target.value = "";
                    const prev = target.previousElementSibling;
                    if (prev) {
                        prev.focus();
                    }
                }
            });

            doneBtn.addEventListener("click", function () {
                let otp = '';
                const inputFields = inputs.getElementsByTagName('input');
                let allFieldsEmpty = true;
                let allFieldsFilled = true;

                for (let input of inputFields) {
                    otp += input.value;
                    if (input.value === "") {
                        allFieldsFilled = false;
                    } else {
                        allFieldsEmpty = false;
                    }
                }

                if (allFieldsEmpty) {
                    otpMsg.textContent = "Please enter OTP";
                    otpMsg.style.color = "red";
                } else if (!allFieldsFilled) {
                    otpMsg.textContent = "Invalid OTP";
                    otpMsg.style.color = "red";
                } else {
                    console.log("OTP entered:", otp);

                    // OTP verified successfully
                    // DO NOT clear localStorage (username must stay)

                    window.location.href = "Home.html";
                }
            });
            document.getElementById("log-out-btn").addEventListener("click", function () {
                localStorage.removeItem("username");
                window.location.href = "Login.html";
            });
        });
    </script>
</body>

</html>